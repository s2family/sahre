{% extends "base.html" %}

{% block title %}üîß Admin Panel - File Storage{% endblock %}

{% block body_style %}
background: #f8f9fa;
color: #333;
line-height: 1.6;
min-height: 100vh;
display: flex;
{% endblock %}

{% block header %}{% endblock %}
{% block footer %}{% endblock %}

{% block extra_css %}
/* Sidebar */
.sidebar {
    width: 250px;
    background: #495057;
    color: white;
    min-height: 100vh;
    position: fixed;
    left: 0;
    top: 0;
    z-index: 1000;
}

.sidebar-header {
    padding: 20px;
    background: #343a40;
    border-bottom: 1px solid #6c757d;
    text-align: center;
}

.sidebar-header h2 {
    font-size: 1.2rem;
    font-weight: 600;
}

.sidebar-menu {
    padding: 20px 0;
}

.menu-item {
    padding: 12px 20px;
    cursor: pointer;
    transition: background 0.2s ease;
    border: none;
    background: none;
    color: white;
    text-align: left;
    width: 100%;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.menu-item:hover {
    background: #6c757d;
}

.menu-item.active {
    background: #007bff;
}

/* Main Content */
.main-content {
    margin-left: 250px;
    flex: 1;
    padding: 20px;
}

.header {
    background: white;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header h1 {
    font-size: 1.5rem;
    font-weight: 600;
    color: #495057;
}

.logout-btn {
    padding: 8px 16px;
    background: #dc3545;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    font-size: 0.9rem;
    transition: background 0.2s ease;
}

.logout-btn:hover {
    background: #c82333;
}

/* Stats Cards */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    display: flex;
    align-items: center;
    gap: 15px;
}

.stat-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
}

.stat-icon.users { background: #6f42c1; }
.stat-icon.downloads { background: #e83e8c; }
.stat-icon.videos { background: #17a2b8; }
.stat-icon.banners { background: #28a745; }

.stat-info h3 {
    font-size: 1.5rem;
    font-weight: 700;
    color: #495057;
    margin-bottom: 5px;
}

.stat-info p {
    color: #6c757d;
    font-size: 0.9rem;
}

/* Content Sections */
.content-section {
    background: white;
    border-radius: 8px;
    padding: 25px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.section-header h2 {
    font-size: 1.3rem;
    font-weight: 600;
    color: #495057;
}

/* Tables */
.table-container {
    overflow-x: auto;
}

.table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

.table th,
.table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #dee2e6;
}

.table th {
    background: #f8f9fa;
    font-weight: 600;
    color: #495057;
    font-size: 0.9rem;
}

.table td {
    font-size: 0.9rem;
}

.table tr:hover {
    background: #f8f9fa;
}

/* Status badges */
.status-online {
    color: #28a745;
    font-weight: 600;
}

.status-offline {
    color: #dc3545;
    font-weight: 600;
}

/* Cache info */
.cache-info {
    background: linear-gradient(135deg, #17a2b8, #20c997);
    color: white;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.cache-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.cache-stat {
    text-align: center;
}

.cache-stat .number {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 5px;
}

.cache-stat .label {
    font-size: 0.8rem;
    opacity: 0.9;
}

/* Admin Settings */
.admin-settings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.setting-card {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid #667eea;
}

.setting-card h4 {
    color: #333;
    margin-bottom: 15px;
    font-size: 1rem;
}

.setting-value {
    font-size: 1.2rem;
    font-weight: 600;
    color: #667eea;
    margin-bottom: 5px;
}

.setting-description {
    font-size: 0.85rem;
    color: #666;
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    overflow-y: auto;
    padding: 20px 0;
}

.modal-content {
    background: white;
    margin: 0 auto;
    padding: 0;
    border-radius: 8px;
    width: 90%;
    max-width: 500px;
    position: relative;
    max-height: 90vh;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid #dee2e6;
    flex-shrink: 0;
    background: white;
    position: sticky;
    top: 0;
    z-index: 1;
}

.modal-body {
    padding: 20px;
    flex: 1;
    overflow-y: auto;
}

.close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: #999;
}

.close:hover {
    color: #333;
}

/* Loading spinner */
.loading {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Notifications */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 20px;
    border-radius: 4px;
    color: white;
    font-weight: 500;
    z-index: 3000;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.notification.success {
    background: #28a745;
}

.notification.error {
    background: #dc3545;
}

.notification.info {
    background: #17a2b8;
}

/* Responsive */
@media (max-width: 768px) {
    .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
    }

    .sidebar.open {
        transform: translateX(0);
    }

    .main-content {
        margin-left: 0;
    }

    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .admin-settings-grid {
        grid-template-columns: 1fr;
    }
}

.hidden {
    display: none;
}
{% endblock %}

{% block content %}
<!-- Sidebar -->
<div class="sidebar">
    <div class="sidebar-header">
        <h2>üîß Admin Panel</h2>
    </div>
    <div class="sidebar-menu">
        <button class="menu-item active" onclick="showSection('dashboard')">
            <i class="fas fa-chart-pie"></i> Dashboard
        </button>
        <button class="menu-item" onclick="showSection('visitors')">
            <i class="fas fa-users"></i> User Data
        </button>
        <button class="menu-item" onclick="showSection('files')">
            <i class="fas fa-file"></i> File Management
        </button>
        <button class="menu-item" onclick="showSection('cache')">
            <i class="fas fa-database"></i> Cache & Cleanup
        </button>
        <button class="menu-item" onclick="showSection('banners')">
            <i class="fas fa-bullhorn"></i> Banners
        </button>
        <button class="menu-item" onclick="showSection('settings')">
            <i class="fas fa-cog"></i> Settings
        </button>
    </div>
</div>

<!-- Main Content -->
<div class="main-content">
    <!-- Header -->
    <div class="header">
        <h1>Admin Dashboard</h1>
        <div>
            <span>Xin ch√†o, <strong>{{ session.admin_username or 'Admin' }}</strong></span>
            <a href="/admin/logout" class="logout-btn">üö™ ƒêƒÉng xu·∫•t</a>
        </div>
    </div>

    <!-- Dashboard Section -->
    <div id="dashboard-section" class="content-section">
        <h2>üìä T·ªïng quan h·ªá th·ªëng</h2>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon users">üë•</div>
                <div class="stat-info">
                    <h3 id="activeVisitors">--</h3>
                    <p>Ng∆∞·ªùi d√πng online</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon downloads">üìÅ</div>
                <div class="stat-info">
                    <h3 id="totalFiles">--</h3>
                    <p>T·ªïng file</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon videos">üì•</div>
                <div class="stat-info">
                    <h3 id="totalDownloads">--</h3>
                    <p>L∆∞·ª£t t·∫£i</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon banners">üì¢</div>
                <div class="stat-info">
                    <h3 id="activeBanners">--</h3>
                    <p>Banner ho·∫°t ƒë·ªông</p>
                </div>
            </div>
        </div>

        <!-- Admin Control Settings -->
        <h3>‚öôÔ∏è C√†i ƒë·∫∑t ƒëi·ªÅu khi·ªÉn</h3>
        <div class="admin-settings-grid">
            <div class="setting-card">
                <h4>‚è∞ Th·ªùi h·∫°n l∆∞u tr·ªØ</h4>
                <div class="setting-value" id="expireDaysValue">30 ng√†y</div>
                <div class="setting-description">Th·ªùi gian file ƒë∆∞·ª£c l∆∞u tr·ªØ</div>
                <button onclick="editSetting('expire_days')" class="btn btn-primary" style="margin-top: 10px; font-size: 0.8rem; padding: 5px 10px;">Ch·ªânh s·ª≠a</button>
            </div>
            
            <div class="setting-card">
                <h4>üìä Gi·ªõi h·∫°n file</h4>
                <div class="setting-value" id="maxSizeValue">15 GB</div>
                <div class="setting-description">K√≠ch th∆∞·ªõc file t·ªëi ƒëa</div>
                <button onclick="editSetting('max_size')" class="btn btn-primary" style="margin-top: 10px; font-size: 0.8rem; padding: 5px 10px;">Ch·ªânh s·ª≠a</button>
            </div>
            
            <div class="setting-card">
                <h4>üì• Gi·ªõi h·∫°n download</h4>
                <div class="setting-value" id="downloadLimitValue">100 l∆∞·ª£t</div>
                <div class="setting-description">S·ªë l·∫ßn t·∫£i t·ªëi ƒëa m·ªói file</div>
                <button onclick="editSetting('download_limit')" class="btn btn-primary" style="margin-top: 10px; font-size: 0.8rem; padding: 5px 10px;">Ch·ªânh s·ª≠a</button>
            </div>
        </div>
    </div>

    <!-- Visitors Section -->
    <div id="visitors-section" class="content-section" style="display: none;">
        <div class="section-header">
            <h2>üë• User Data</h2>
            <button class="btn btn-secondary" onclick="refreshVisitors()">üîÑ Refresh</button>
        </div>
        <div class="table-container">
            <table class="table" id="visitorsTable">
                <thead>
                    <tr>
                        <th>Session ID</th>
                        <th>IP Address</th>
                        <th>First Visit</th>
                        <th>Page Views</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="5" style="text-align: center; color: #6c757d;">
                            ƒêang t·∫£i d·ªØ li·ªáu...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Files Section -->
    <div id="files-section" class="content-section" style="display: none;">
        <div class="section-header">
            <h2>üìÅ File Management</h2>
            <button class="btn btn-secondary" onclick="refreshFiles()">üîÑ Refresh</button>
        </div>
        <div class="table-container">
            <table class="table" id="filesTable">
                <thead>
                    <tr>
                        <th>File Name</th>
                        <th>Type</th>
                        <th>Size</th>
                        <th>Downloads</th>
                        <th>Upload Date</th>
                        <th>Uploader IP</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="6" style="text-align: center; color: #6c757d;">
                            ƒêang t·∫£i d·ªØ li·ªáu...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Cache Section -->
    <div id="cache-section" class="content-section" style="display: none;">
        <div class="section-header">
            <h2>üßπ Cache Management</h2>
            <button class="btn btn-secondary" onclick="refreshCacheInfo()">üîÑ Refresh</button>
        </div>

        <div class="cache-info" id="cacheInfo">
            <h3><i class="fas fa-info-circle"></i> Th√¥ng tin Cache</h3>
            <div class="cache-stats">
                <div class="cache-stat">
                    <div class="number" id="cacheFiles">--</div>
                    <div class="label">Files</div>
                </div>
                <div class="cache-stat">
                    <div class="number" id="cacheSize">--</div>
                    <div class="label">Size (MB)</div>
                </div>
            </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px;">
            <div>
                <h3>üßπ D·ªçn d·∫πp th·ªß c√¥ng</h3>
                <p style="margin-bottom: 20px; color: #6c757d;">X√≥a file h·∫øt h·∫°n ngay l·∫≠p t·ª©c</p>
                <button class="btn btn-primary" onclick="cleanupCache()">
                    <i class="fas fa-broom"></i> D·ªçn d·∫πp file h·∫øt h·∫°n
                </button>
                <button class="btn btn-danger" onclick="clearAllCache()" style="margin-left: 10px;">
                    <i class="fas fa-trash"></i> X√≥a t·∫•t c·∫£
                </button>
            </div>
            
            <div>
                <h3>‚è∞ T·ª± ƒë·ªông d·ªçn d·∫πp</h3>
                <div class="form-group">
                    <label>Kho·∫£ng th·ªùi gian (ph√∫t):</label>
                    <input type="number" class="form-input" id="autoCleanupInterval" 
                           min="30" max="1440" value="60" placeholder="60">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="autoCleanupEnabled" style="margin-right: 8px;">
                        B·∫≠t t·ª± ƒë·ªông d·ªçn d·∫πp
                    </label>
                </div>
                <button class="btn btn-primary" onclick="saveAutoCleanupSettings()">
                    <i class="fas fa-save"></i> L∆∞u c√†i ƒë·∫∑t
                </button>
            </div>
        </div>
    </div>

    <!-- Banners Section -->
    <div id="banners-section" class="content-section" style="display: none;">
        <div class="section-header">
            <h2>üì¢ Qu·∫£n l√Ω Banners</h2>
            <div>
                <button class="btn btn-primary" onclick="openBannerModal()">
                    <i class="fas fa-plus"></i> Th√™m Banner
                </button>
                <button class="btn btn-secondary" onclick="refreshBanners()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>
        <div class="table-container">
            <table class="table" id="bannersTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Ti√™u ƒë·ªÅ</th>
                        <th>V·ªã tr√≠</th>
                        <th>Clicks</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="6" style="text-align: center; color: #6c757d;">
                            ƒêang t·∫£i d·ªØ li·ªáu...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Settings Section -->
    <div id="settings-section" class="content-section" style="display: none;">
        <div class="section-header">
            <h2>‚öôÔ∏è C√†i ƒë·∫∑t h·ªá th·ªëng</h2>
        </div>
        
        <div style="max-width: 600px;">
            <h3>üîê ƒê·ªïi m·∫≠t kh·∫©u Admin</h3>
            <form id="passwordForm">
                <div class="form-group">
                    <label>M·∫≠t kh·∫©u m·ªõi:</label>
                    <input type="password" class="form-input" id="newPassword" required 
                           placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi (t·ªëi thi·ªÉu 6 k√Ω t·ª±)">
                </div>
                <div class="form-group">
                    <label>X√°c nh·∫≠n m·∫≠t kh·∫©u:</label>
                    <input type="password" class="form-input" id="confirmPassword" required 
                           placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi">
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-key"></i> C·∫≠p nh·∫≠t m·∫≠t kh·∫©u
                </button>
            </form>
            
            <hr style="margin: 30px 0;">
            
            <h3>üîß C√†i ƒë·∫∑t kh√°c</h3>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="maintenanceMode" style="margin-right: 8px;"> 
                    Ch·∫ø ƒë·ªô b·∫£o tr√¨
                </label>
                <small style="display: block; color: #6c757d; margin-top: 5px;">
                    Khi b·∫≠t, website s·∫Ω hi·ªÉn th·ªã trang b·∫£o tr√¨ cho ng∆∞·ªùi d√πng
                </small>
            </div>
            <button class="btn btn-primary" onclick="saveSettings()">
                <i class="fas fa-save"></i> L∆∞u c√†i ƒë·∫∑t
            </button>
        </div>
    </div>
</div>

<!-- Banner Modal -->
<div id="bannerModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-bullhorn"></i> <span id="modalTitle">Th√™m Banner M·ªõi</span></h3>
            <button class="close" onclick="closeBannerModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="bannerForm">
                <input type="hidden" id="bannerId" value="">
                
                <div class="form-group">
                    <label>Ti√™u ƒë·ªÅ: <span style="color: red;">*</span></label>
                    <input type="text" class="form-input" id="bannerTitle" required 
                           placeholder="Nh·∫≠p ti√™u ƒë·ªÅ banner">
                </div>
                
                <div class="form-group">
                    <label>M√¥ t·∫£:</label>
                    <textarea class="form-input" id="bannerDescription" rows="3"
                              placeholder="Nh·∫≠p m√¥ t·∫£ banner (t√πy ch·ªçn)"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Link URL:</label>
                    <input type="url" class="form-input" id="bannerUrl" 
                           placeholder="https://example.com (t√πy ch·ªçn)">
                </div>
                
                <div class="form-group">
                    <label>V·ªã tr√≠: <span style="color: red;">*</span></label>
                    <select class="form-input" id="bannerPosition" required>
                        <option value="">-- Ch·ªçn v·ªã tr√≠ --</option>
                        <option value="left">B√™n tr√°i</option>
                        <option value="right">B√™n ph·∫£i</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="bannerStatus" checked style="margin-right: 8px;">
                        K√≠ch ho·∫°t banner
                    </label>
                </div>
                
                <div class="form-group">
                    <label>H√¨nh ·∫£nh:</label>
                    <input type="file" class="form-input" id="bannerImage" accept="image/*">
                    <small style="color: #666;">PNG, JPG, JPEG, GIF, WEBP (T·ªëi ƒëa 16MB)</small>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeBannerModal()">
                        <i class="fas fa-times"></i> H·ªßy
                    </button>
                    <button type="submit" class="btn btn-primary" id="saveBannerBtn">
                        <i class="fas fa-save"></i> L∆∞u Banner
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Setting Edit Modal -->
<div id="settingModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-cog"></i> <span id="settingModalTitle">Ch·ªânh s·ª≠a c√†i ƒë·∫∑t</span></h3>
            <button class="close" onclick="closeSettingModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="settingForm">
                <input type="hidden" id="settingKey" value="">
                
                <div class="form-group">
                    <label id="settingLabel">Gi√° tr·ªã:</label>
                    <input type="number" class="form-input" id="settingValue" required>
                    <small id="settingDescription" style="color: #666;"></small>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeSettingModal()">
                        <i class="fas fa-times"></i> H·ªßy
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> L∆∞u thay ƒë·ªïi
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    let currentSection = 'dashboard';
    
    // Load initial data when page loads
    document.addEventListener('DOMContentLoaded', function() {
        loadDashboardData();
        loadAdminSettings();
        
        // Setup forms
        document.getElementById('passwordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            updatePassword();
        });
        
        document.getElementById('bannerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveBanner();
        });
        
        document.getElementById('settingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveAdminSetting();
        });
    });

    // Auto refresh data every 30 seconds
    setInterval(() => {
        if (currentSection === 'dashboard') {
            loadDashboardData();
        }
    }, 30000);

    // Show/hide sections
    function showSection(section) {
        // Hide all sections
        document.querySelectorAll('.content-section').forEach(el => {
            el.style.display = 'none';
        });
        
        // Remove active class from all menu items
        document.querySelectorAll('.menu-item').forEach(el => {
            el.classList.remove('active');
        });
        
        // Show selected section
        document.getElementById(section + '-section').style.display = 'block';
        
        // Add active class to clicked menu item
        event.target.classList.add('active');
        
        currentSection = section;
        
        // Load data for specific section
        if (section === 'visitors') loadVisitors();
        if (section === 'files') loadFiles();
        if (section === 'banners') loadBanners();
        if (section === 'cache') loadCacheInfo();
        if (section === 'settings') loadSettings();
    }

    // Load dashboard statistics
    async function loadDashboardData() {
        try {
            const response = await fetch('/admin/api/stats');
            const data = await response.json();
            
            if (data.success) {
                const stats = data.stats;
                document.getElementById('activeVisitors').textContent = stats.visitors.active_now;
                document.getElementById('totalFiles').textContent = stats.files.total_files;
                document.getElementById('totalDownloads').textContent = stats.files.total_downloads;
                document.getElementById('activeBanners').textContent = stats.banners.active_banners;
            }
        } catch (error) {
            console.error('Error loading dashboard data:', error);
        }
    }

    // Load admin settings
    async function loadAdminSettings() {
        try {
            const response = await fetch('/admin/api/settings');
            const data = await response.json();
            
            if (data.success) {
                data.settings.forEach(setting => {
                    if (setting.key === 'default_expire_days') {
                        document.getElementById('expireDaysValue').textContent = setting.value + ' ng√†y';
                    }
                    if (setting.key === 'max_file_size_gb') {
                        document.getElementById('maxSizeValue').textContent = setting.value + ' GB';
                    }
                    if (setting.key === 'max_download_limit') {
                        document.getElementById('downloadLimitValue').textContent = setting.value + ' l∆∞·ª£t';
                    }
                    if (setting.key === 'maintenance_mode') {
                        document.getElementById('maintenanceMode').checked = setting.value === 'true';
                    }
                    if (setting.key === 'auto_cleanup_enabled') {
                        document.getElementById('autoCleanupEnabled').checked = setting.value === 'true';
                    }
                    if (setting.key === 'cleanup_interval_minutes') {
                        document.getElementById('autoCleanupInterval').value = setting.value;
                    }
                });
            }
        } catch (error) {
            console.error('Error loading admin settings:', error);
        }
    }

    // Edit admin setting
    function editSetting(settingType) {
        const modal = document.getElementById('settingModal');
        const titleEl = document.getElementById('settingModalTitle');
        const keyEl = document.getElementById('settingKey');
        const labelEl = document.getElementById('settingLabel');
        const valueEl = document.getElementById('settingValue');
        const descEl = document.getElementById('settingDescription');
        
        if (settingType === 'expire_days') {
            titleEl.textContent = 'Ch·ªânh s·ª≠a th·ªùi h·∫°n l∆∞u tr·ªØ';
            keyEl.value = 'default_expire_days';
            labelEl.textContent = 'S·ªë ng√†y l∆∞u tr·ªØ:';
            valueEl.value = document.getElementById('expireDaysValue').textContent.replace(' ng√†y', '');
            descEl.textContent = 'Th·ªùi gian file ƒë∆∞·ª£c l∆∞u tr·ªØ tr∆∞·ªõc khi t·ª± ƒë·ªông x√≥a';
            valueEl.min = 1;
            valueEl.max = 365;
        } else if (settingType === 'max_size') {
            titleEl.textContent = 'Ch·ªânh s·ª≠a gi·ªõi h·∫°n k√≠ch th∆∞·ªõc';
            keyEl.value = 'max_file_size_gb';
            labelEl.textContent = 'K√≠ch th∆∞·ªõc t·ªëi ƒëa (GB):';
            valueEl.value = document.getElementById('maxSizeValue').textContent.replace(' GB', '');
            descEl.textContent = 'K√≠ch th∆∞·ªõc file t·ªëi ƒëa cho ph√©p upload';
            valueEl.min = 1;
            valueEl.max = 50;
        } else if (settingType === 'download_limit') {
            titleEl.textContent = 'Ch·ªânh s·ª≠a gi·ªõi h·∫°n download';
            keyEl.value = 'max_download_limit';
            labelEl.textContent = 'S·ªë l∆∞·ª£t t·∫£i t·ªëi ƒëa:';
            valueEl.value = document.getElementById('downloadLimitValue').textContent.replace(' l∆∞·ª£t', '');
            descEl.textContent = 'S·ªë l·∫ßn download t·ªëi ƒëa cho m·ªói file';
            valueEl.min = 1;
            valueEl.max = 1000;
        }
        
        modal.style.display = 'block';
    }

    function closeSettingModal() {
        document.getElementById('settingModal').style.display = 'none';
    }

    // Save admin setting
    async function saveAdminSetting() {
        const key = document.getElementById('settingKey').value;
        const value = document.getElementById('settingValue').value;
        
        try {
            const response = await fetch('/admin/api/settings', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    settings: {
                        [key]: value
                    }
                })
            });
            
            const data = await response.json();
            if (data.success) {
                showNotification('success', 'C√†i ƒë·∫∑t ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t');
                closeSettingModal();
                loadAdminSettings();
            } else {
                showNotification('error', 'L·ªói: ' + data.error);
            }
        } catch (error) {
            showNotification('error', 'L·ªói khi l∆∞u c√†i ƒë·∫∑t');
        }
    }

    // Load visitors
    async function loadVisitors() {
        try {
            const response = await fetch('/admin/api/visitors');
            const data = await response.json();
            
            if (data.success) {
                const tbody = document.querySelector('#visitorsTable tbody');
                tbody.innerHTML = '';
                
                data.visitors.forEach(visitor => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${visitor.session_id}</td>
                        <td>${visitor.ip_address}</td>
                        <td>${formatDateTime(visitor.first_visit)}</td>
                        <td>${visitor.page_views}</td>
                        <td class="${visitor.is_active ? 'status-online' : 'status-offline'}">
                            ${visitor.is_active ? 'ONLINE' : 'OFFLINE'}
                        </td>
                    `;
                });
                
                if (data.visitors.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #6c757d;">Ch∆∞a c√≥ d·ªØ li·ªáu</td></tr>';
                }
            }
        } catch (error) {
            console.error('Error loading visitors:', error);
            showNotification('error', 'L·ªói t·∫£i d·ªØ li·ªáu visitors');
        }
    }

    // Load files
    async function loadFiles() {
        try {
            const response = await fetch('/admin/api/files');
            const data = await response.json();
            
            if (data.success) {
                const tbody = document.querySelector('#filesTable tbody');
                tbody.innerHTML = '';
                
                data.files.forEach(file => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td><strong>${file.name}</strong><br><small style="color: #6c757d;">${file.id}</small></td>
                        <td><span style="text-transform: uppercase;">${file.type}</span></td>
                        <td>${file.size}</td>
                        <td><strong>${file.downloads}</strong></td>
                        <td>${formatDateTime(file.uploaded_at)}</td>
                        <td>${file.uploader_ip}</td>
                    `;
                });
                
                if (data.files.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #6c757d;">Ch∆∞a c√≥ file n√†o</td></tr>';
                }
            }
        } catch (error) {
            console.error('Error loading files:', error);
            showNotification('error', 'L·ªói t·∫£i d·ªØ li·ªáu files');
        }
    }

    // Load banners
    async function loadBanners() {
        try {
            const response = await fetch('/admin/api/banners');
            const data = await response.json();
            
            if (data.success) {
                const tbody = document.querySelector('#bannersTable tbody');
                tbody.innerHTML = '';
                
                data.banners.forEach(banner => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>#${banner.id}</td>
                        <td>${banner.title}</td>
                        <td>${banner.position === 'left' ? 'Tr√°i' : 'Ph·∫£i'}</td>
                        <td>${banner.clicks}</td>
                        <td class="${banner.status ? 'status-online' : 'status-offline'}">
                            ${banner.status ? 'Ho·∫°t ƒë·ªông' : 'T·∫Øt'}
                        </td>
                        <td>
                            <button class="btn btn-primary" onclick="editBanner(${banner.id})" style="font-size: 0.8rem; padding: 5px 10px; margin-right: 5px;">
                                <i class="fas fa-edit"></i> S·ª≠a
                            </button>
                            <button class="btn btn-danger" onclick="deleteBanner(${banner.id})" style="font-size: 0.8rem; padding: 5px 10px;">
                                <i class="fas fa-trash"></i> X√≥a
                            </button>
                        </td>
                    `;
                });
                
                if (data.banners.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #6c757d;">Ch∆∞a c√≥ banner n√†o</td></tr>';
                }
            }
        } catch (error) {
            console.error('Error loading banners:', error);
            showNotification('error', 'L·ªói t·∫£i d·ªØ li·ªáu banners');
        }
    }

    // Load cache info
    async function loadCacheInfo() {
        try {
            const response = await fetch('/admin/api/cache');
            const data = await response.json();
            
            if (data.success) {
                const cacheInfo = data.cache_info;
                document.getElementById('cacheFiles').textContent = cacheInfo.total_files;
                document.getElementById('cacheSize').textContent = cacheInfo.total_size_mb;
            }
        } catch (error) {
            console.error('Error loading cache info:', error);
            showNotification('error', 'L·ªói t·∫£i th√¥ng tin cache');
        }
    }

    // Banner management
    function openBannerModal() {
        document.getElementById('bannerModal').style.display = 'block';
        document.getElementById('bannerForm').reset();
        document.getElementById('bannerId').value = '';
        document.getElementById('modalTitle').textContent = 'Th√™m Banner M·ªõi';
        document.getElementById('bannerStatus').checked = true;
        document.getElementById('bannerPosition').value = '';
    }

    function closeBannerModal() {
        document.getElementById('bannerModal').style.display = 'none';
    }

    async function saveBanner() {
        const bannerId = document.getElementById('bannerId').value;
        const submitBtn = document.getElementById('saveBannerBtn');
        const originalText = submitBtn.innerHTML;
        
        const title = document.getElementById('bannerTitle').value.trim();
        const position = document.getElementById('bannerPosition').value;
        
        if (!title) {
            showNotification('error', 'Vui l√≤ng nh·∫≠p ti√™u ƒë·ªÅ banner');
            return;
        }
        
        if (!position) {
            showNotification('error', 'Vui l√≤ng ch·ªçn v·ªã tr√≠ hi·ªÉn th·ªã');
            return;
        }
        
        submitBtn.innerHTML = '<span class="loading"></span> ƒêang l∆∞u...';
        submitBtn.disabled = true;
        
        try {
            const bannerData = {
                title: title,
                description: document.getElementById('bannerDescription').value.trim(),
                link_url: document.getElementById('bannerUrl').value.trim(),
                position: position,
                status: document.getElementById('bannerStatus').checked
            };
            
            // Handle image upload if provided
            const imageFile = document.getElementById('bannerImage').files[0];
            if (imageFile) {
                if (imageFile.size > 16 * 1024 * 1024) {
                    throw new Error('File qu√° l·ªõn. K√≠ch th∆∞·ªõc t·ªëi ƒëa 16MB');
                }
                
                const formData = new FormData();
                formData.append('image', imageFile);
                
                const imageResponse = await fetch('/admin/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const imageData = await imageResponse.json();
                
                if (imageData.success) {
                    bannerData.image_path = imageData.image_path;
                } else {
                    throw new Error('Upload h√¨nh ·∫£nh th·∫•t b·∫°i: ' + imageData.error);
                }
            }
            
            if (bannerId) {
                bannerData.id = parseInt(bannerId);
            }
            
            const method = bannerId ? 'PUT' : 'POST';
            const bannerResponse = await fetch('/admin/api/banners', {
                method: method,
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(bannerData)
            });
            
            const result = await bannerResponse.json();
            
            if (result.success) {
                showNotification('success', result.message);
                closeBannerModal();
                loadBanners();
                loadDashboardData();
            } else {
                throw new Error(result.error);
            }
            
        } catch (error) {
            showNotification('error', error.message);
        } finally {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }
    }

    async function deleteBanner(bannerId) {
        if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a banner n√†y?')) return;
        
        try {
            const response = await fetch('/admin/api/banners', {
                method: 'DELETE',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({id: bannerId})
            });
            
            const data = await response.json();
            if (data.success) {
                showNotification('success', data.message);
                loadBanners();
                loadDashboardData();
            } else {
                showNotification('error', 'L·ªói: ' + data.error);
            }
        } catch (error) {
            showNotification('error', 'L·ªói khi x√≥a banner');
        }
    }

    // Cache management
    async function cleanupCache() {
        if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën d·ªçn d·∫πp file h·∫øt h·∫°n?')) return;
        
        try {
            const response = await fetch('/admin/api/cache', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ action: 'cleanup_old' })
            });
            
            const data = await response.json();
            if (data.success) {
                showNotification('success', data.message);
                loadCacheInfo();
            } else {
                showNotification('error', 'L·ªói: ' + data.error);
            }
        } catch (error) {
            console.error('Error cleaning cache:', error);
            showNotification('error', 'L·ªói khi d·ªçn d·∫πp cache');
        }
    }

    async function clearAllCache() {
        if (!confirm('C·∫¢NH B√ÅO: B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a T·∫§T C·∫¢ file? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!')) return;
        
        try {
            const response = await fetch('/admin/api/cache', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ action: 'clear_all' })
            });
            
            const data = await response.json();
            if (data.success) {
                showNotification('success', data.message);
                loadCacheInfo();
            } else {
                showNotification('error', 'L·ªói: ' + data.error);
            }
        } catch (error) {
            console.error('Error clearing cache:', error);
            showNotification('error', 'L·ªói khi x√≥a cache');
        }
    }

    async function saveAutoCleanupSettings() {
        const interval = parseInt(document.getElementById('autoCleanupInterval').value);
        const enabled = document.getElementById('autoCleanupEnabled').checked;
        
        if (enabled && (!interval || interval < 30)) {
            showNotification('error', 'Kho·∫£ng th·ªùi gian t·ªëi thi·ªÉu l√† 30 ph√∫t');
            return;
        }
        
        try {
            const response = await fetch('/admin/api/settings', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    settings: {
                        auto_cleanup_enabled: enabled ? 'true' : 'false',
                        cleanup_interval_minutes: interval.toString()
                    }
                })
            });
            
            const data = await response.json();
            if (data.success) {
                showNotification('success', 'ƒê√£ l∆∞u c√†i ƒë·∫∑t t·ª± ƒë·ªông d·ªçn d·∫πp');
            } else {
                showNotification('error', 'L·ªói: ' + data.error);
            }
        } catch (error) {
            console.error('Error saving auto cleanup settings:', error);
            showNotification('error', 'L·ªói khi l∆∞u c√†i ƒë·∫∑t');
        }
    }

    // Password update
    async function updatePassword() {
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        if (newPassword !== confirmPassword) {
            showNotification('error', 'M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp');
            return;
        }
        
        if (newPassword.length < 6) {
            showNotification('error', 'M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±');
            return;
        }
        
        try {
            const response = await fetch('/admin/api/settings', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    settings: {
                        admin_password: newPassword
                    }
                })
            });
            
            const data = await response.json();
            if (data.success) {
                showNotification('success', 'M·∫≠t kh·∫©u ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t');
                document.getElementById('passwordForm').reset();
            } else {
                showNotification('error', 'L·ªói: ' + data.error);
            }
        } catch (error) {
            showNotification('error', 'L·ªói khi c·∫≠p nh·∫≠t m·∫≠t kh·∫©u');
        }
    }

    async function saveSettings() {
        const maintenanceMode = document.getElementById('maintenanceMode').checked;
        
        try {
            const response = await fetch('/admin/api/settings', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    settings: {
                        maintenance_mode: maintenanceMode ? 'true' : 'false'
                    }
                })
            });
            
            const data = await response.json();
            if (data.success) {
                showNotification('success', 'C√†i ƒë·∫∑t ƒë√£ ƒë∆∞·ª£c l∆∞u');
            } else {
                showNotification('error', 'L·ªói: ' + data.error);
            }
        } catch (error) {
            showNotification('error', 'L·ªói khi l∆∞u c√†i ƒë·∫∑t');
        }
    }

    // Refresh functions
    function refreshVisitors() {
        loadVisitors();
        showNotification('info', 'ƒê√£ l√†m m·ªõi d·ªØ li·ªáu visitors');
    }

    function refreshFiles() {
        loadFiles();
        showNotification('info', 'ƒê√£ l√†m m·ªõi d·ªØ li·ªáu files');
    }

    function refreshBanners() {
        loadBanners();
        showNotification('info', 'ƒê√£ l√†m m·ªõi d·ªØ li·ªáu banners');
    }

    function refreshCacheInfo() {
        loadCacheInfo();
        showNotification('info', 'ƒê√£ l√†m m·ªõi th√¥ng tin cache');
    }

    // Utility functions
    function formatDateTime(dateString) {
        if (!dateString) return '--';
        const date = new Date(dateString);
        return date.toLocaleDateString('vi-VN') + ' ' + date.toLocaleTimeString('vi-VN', {hour: '2-digit', minute: '2-digit'});
    }

    // Show notification
    function showNotification(type, message) {
        // Remove existing notifications
        document.querySelectorAll('.notification').forEach(n => n.remove());
        
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        // Auto hide after 5 seconds
        setTimeout(() => {
            notification.remove();
        }, 5000);
    }

    // Edit banner function
    async function editBanner(bannerId) {
        try {
            const response = await fetch('/admin/api/banners');
            const data = await response.json();
            
            if (data.success) {
                const banner = data.banners.find(b => b.id === bannerId);
                if (banner) {
                    document.getElementById('bannerId').value = banner.id;
                    document.getElementById('bannerTitle').value = banner.title;
                    document.getElementById('bannerDescription').value = banner.description || '';
                    document.getElementById('bannerUrl').value = banner.link_url || '';
                    document.getElementById('bannerPosition').value = banner.position;
                    document.getElementById('bannerStatus').checked = banner.status;
                    document.getElementById('modalTitle').textContent = 'Ch·ªânh s·ª≠a Banner';
                    
                    document.getElementById('bannerModal').style.display = 'block';
                }
            }
        } catch (error) {
            showNotification('error', 'L·ªói khi t·∫£i th√¥ng tin banner');
        }
    }

    // Load settings function
    async function loadSettings() {
        await loadAdminSettings();
    }

    // Close modals when clicking outside
    window.onclick = function(event) {
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        });
    }

    // Handle responsive sidebar
    function toggleSidebar() {
        const sidebar = document.querySelector('.sidebar');
        sidebar.classList.toggle('open');
    }

    // Add mobile menu button for responsive
    if (window.innerWidth <= 768) {
        const header = document.querySelector('.header');
        const menuBtn = document.createElement('button');
        menuBtn.innerHTML = '<i class="fas fa-bars"></i>';
        menuBtn.className = 'btn btn-secondary';
        menuBtn.style.marginRight = '10px';
        menuBtn.onclick = toggleSidebar;
        header.querySelector('div').insertBefore(menuBtn, header.querySelector('div').firstChild);
    }

    // Handle window resize
    window.addEventListener('resize', function() {
        if (window.innerWidth > 768) {
            document.querySelector('.sidebar').classList.remove('open');
        }
    });

    // Form validation helper
    function validateForm(formId, requiredFields) {
        const form = document.getElementById(formId);
        let isValid = true;
        
        requiredFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (!field.value.trim()) {
                field.style.borderColor = '#dc3545';
                isValid = false;
            } else {
                field.style.borderColor = '#ced4da';
            }
        });
        
        return isValid;
    }

    // File size formatter
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 B';
        const k = 1024;
        const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
    }

    // Copy to clipboard helper
    function copyToClipboard(text) {
        if (navigator.clipboard) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('success', 'ƒê√£ copy v√†o clipboard');
            }).catch(() => {
                fallbackCopyToClipboard(text);
            });
        } else {
            fallbackCopyToClipboard(text);
        }
    }

    function fallbackCopyToClipboard(text) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        try {
            document.execCommand('copy');
            showNotification('success', 'ƒê√£ copy v√†o clipboard');
        } catch (err) {
            showNotification('error', 'Kh√¥ng th·ªÉ copy');
        }
        document.body.removeChild(textArea);
    }

    // Export data functions
    function exportVisitors() {
        fetch('/admin/api/visitors')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const csv = convertToCSV(data.visitors);
                    downloadCSV(csv, 'visitors.csv');
                }
            });
    }

    function exportFiles() {
        fetch('/admin/api/files')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const csv = convertToCSV(data.files);
                    downloadCSV(csv, 'files.csv');
                }
            });
    }

    function convertToCSV(data) {
        if (!data.length) return '';
        
        const headers = Object.keys(data[0]);
        const csvContent = [
            headers.join(','),
            ...data.map(row => 
                headers.map(header => 
                    typeof row[header] === 'string' && row[header].includes(',') 
                        ? `"${row[header]}"` 
                        : row[header]
                ).join(',')
            )
        ].join('\n');
        
        return csvContent;
    }

    function downloadCSV(csv, filename) {
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        
        if (link.download !== undefined) {
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    }

    // Search and filter functions
    function searchTable(tableId, searchTerm) {
        const table = document.getElementById(tableId);
        const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
        
        for (let i = 0; i < rows.length; i++) {
            const row = rows[i];
            const cells = row.getElementsByTagName('td');
            let found = false;
            
            for (let j = 0; j < cells.length; j++) {
                if (cells[j].textContent.toLowerCase().includes(searchTerm.toLowerCase())) {
                    found = true;
                    break;
                }
            }
            
            row.style.display = found ? '' : 'none';
        }
    }

    // Auto-save settings
    let settingsTimeout;
    function autoSaveSettings() {
        clearTimeout(settingsTimeout);
        settingsTimeout = setTimeout(() => {
            saveSettings();
        }, 2000);
    }

    // Add auto-save listeners to settings inputs
    document.addEventListener('DOMContentLoaded', function() {
        const settingsInputs = ['maintenanceMode', 'autoCleanupEnabled', 'autoCleanupInterval'];
        settingsInputs.forEach(inputId => {
            const input = document.getElementById(inputId);
            if (input) {
                input.addEventListener('change', autoSaveSettings);
            }
        });
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Ctrl + R: Refresh current section
        if (e.ctrlKey && e.key === 'r') {
            e.preventDefault();
            if (currentSection === 'visitors') refreshVisitors();
            else if (currentSection === 'files') refreshFiles();
            else if (currentSection === 'banners') refreshBanners();
            else if (currentSection === 'cache') refreshCacheInfo();
            else loadDashboardData();
        }
        
        // Escape: Close modals
        if (e.key === 'Escape') {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
        }
    });

    // Initialize tooltips and help text
    function initializeTooltips() {
        const tooltips = document.querySelectorAll('[data-tooltip]');
        tooltips.forEach(element => {
            element.addEventListener('mouseenter', function() {
                const tooltip = document.createElement('div');
                tooltip.className = 'tooltip';
                tooltip.textContent = this.getAttribute('data-tooltip');
                tooltip.style.cssText = `
                    position: absolute;
                    background: #333;
                    color: white;
                    padding: 5px 10px;
                    border-radius: 4px;
                    font-size: 12px;
                    z-index: 9999;
                    pointer-events: none;
                `;
                document.body.appendChild(tooltip);
                
                const rect = this.getBoundingClientRect();
                tooltip.style.left = rect.left + 'px';
                tooltip.style.top = (rect.bottom + 5) + 'px';
                
                this._tooltip = tooltip;
            });
            
            element.addEventListener('mouseleave', function() {
                if (this._tooltip) {
                    this._tooltip.remove();
                    this._tooltip = null;
                }
            });
        });
    }

    // Initialize tooltips when DOM is ready
    document.addEventListener('DOMContentLoaded', initializeTooltips);

    // Print function for reports
    function printReport(sectionId) {
        const content = document.getElementById(sectionId).cloneNode(true);
        const printWindow = window.open('', '_blank');
        
        printWindow.document.write(`
            <html>
                <head>
                    <title>Admin Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        .no-print { display: none; }
                    </style>
                </head>
                <body>
                    <h1>File Storage Admin Report</h1>
                    <p>Generated on: ${new Date().toLocaleString('vi-VN')}</p>
                    ${content.innerHTML}
                </body>
            </html>
        `);
        
        printWindow.document.close();
        printWindow.print();
    }

    console.log('Admin panel initialized successfully');
</script>
{% endblock %}
